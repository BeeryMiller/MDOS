; TASKHEADS
;
; 5.11.2022
;      WARNING: Multiple address interdependencies here and OSTASK, OSHEADx
;               DO NOT add/remove from the AORG sections
;               For example, BREAK== >00FE
;
;      OSHEAD1S - similar, with AORG
;      OSTASK - similar but DORG! Structure only! No values!
;      There are some differences that we should review
;
       DEF  FREPTR,CURDRV,MAXDRV,ALIASA
       DEF  PMTSTR,PATH#P,GPLPAR,ALIASP
       DEF  TSKMAP,BREAK,CTLP,CTLS
       DEF  CMDSTR
*
       DEF  TURX,TURXMN,TURXMX
       DEF  TURY,TURYMN,TURYMX
       DEF  PAGE,PAGEPX
       DEF  COTASK
       DEF  LINFLG,LINPTR
       DEF  ESCSEQ,ESCCNT,ESCROU,ESCDAT,STDCLR
       DEF  DELON
*
INTREG EQU  >F080
XOPREG EQU  >F0A0
SYS1   EQU  >F0A0
SYS2   EQU  >F0C0
SYSREG EQU  >F0E0
SCRATC EQU  >F0E0
MAPPER EQU  >F110
*
       AORG 0
*
RSETVC DATA INTREG,KILLIT
       DATA INTREG,INT1       9901 interrupt
       DATA INTREG,INT2       MID trap
       DATA INTREG,INT3       internal timer interrupt
       DATA INTREG,INT4       external bus interrupt
*
       DATA 0,0
*
INT1   LIMI 0
       LI   R11,1
       JMP  INTCAL
*
INT2   LIMI 0
       LI   R11,2
       JMP  INTCAL
*
INT3   LIMI 0
       LI   R11,3
       JMP  INTCAL
*
INT4   LIMI 0
       LI   R11,4
       JMP  INTCAL
*
       AORG >40               XOP table
SYSXOP DATA XOPREG,XOPCAL
       DATA >FFD8,>FFF8       USER #1        RSBUG
       DATA XOPREG,ABORTX     USER #2
       DATA XOPREG,ABORTX     USER #3
       DATA XOPREG,ABORTX     USER #4
       DATA XOPREG,ABORTX     USER #5
       DATA XOPREG,ABORTX     USER #6
       DATA XOPREG,ABORTX     USER #7
       DATA XOPREG,ABORTX     USER #8
       DATA XOPREG,ABORTX     USER #9
       DATA XOPREG,ABORTX     USER #10
       DATA XOPREG,ABORTX     USER #11
       DATA XOPREG,ABORTX     USER #12
       DATA XOPREG,ABORTX     USER #13
       DATA XOPREG,ABORTX     USER #14
       DATA XOPREG,ABORTX     USER #15
*
       AORG >80               start after XOPS
*
XOPCAL LIMI 0
       MOV  *R11,R11
INTCAL MOV  @MAPPER,@TSKMAP
       MOV  @MAPPER,@SYSREG
       MOV  @MAPPER+2,@TSKMAP+2
       MOV  @MAPPER+4,@TSKMAP+4
       MOV  @MAPPER+6,@TSKMAP+6
       CLR  @MAPPER
       NOP                                   we page OS here...
ABORTX RTWP
*
KILLIT LIMI 0
       CLR  R11
       JMP  INTCAL
*
       DATA 0,0,0,0,0,0
       DATA 0,0,0,0,0,0,0,0
*
       DATA 0,0,0,0
DELON  DATA 0
ESCSEQ DATA 0
ESCCNT DATA 0
ESCROU DATA 0
ESCDAT DATA 0
STDCLR DATA 0
LINFLG DATA 0
LINPTR DATA 0
COTASK DATA 0
PAGE   DATA 0
PAGEPX DATA 0
TURX   DATA 0
TURXMN DATA 0
TURXMX DATA 0
TURY   DATA 0
TURYMN DATA 0
TURYMX DATA 0
CTLP   DATA 0            ;>00FA
CTLS   DATA 0            ;>00FC
BREAK  DATA 0            ;>00FE
*
       AORG >0100
TSKTBL BYTE 00           TASK ID #
MAXDRV BYTE 'J'          MAXIMUM ALIAS LETTER USER CAN SPECIFY
STATE  BYTE >FF          PROCESS STATE
SLICE  BYTE 6            NUMBER OF SLICES LEFT UNTIL SWAPPED OUT
PNAME  TEXT '        '   NAME OF THIS TASK
UWP    DATA >F000        USER WORKSPACE POINTER
UPC    DATA >0400        USER PROGRAM COUNTER
UST    DATA >0002        USER STATUS REGISTER
MEMLST DATA 0            POINTER TO MEMORY LIST
TSKMAP DATA 0,0,0,0      SAVED MEMORY MAP USED DURING XOPS AND INTERRUPTS
CURDRV DATA ALIASA       POINTER TO CURRENT DRIVE ENTRY
PATH#P DATA 0            POINTER TO TEXT FOR PATH COMMAND
BLKDEV DATA 0            POINTER TO NAMES OF BLOCK DEVICES
FREPTR DATA FRENOD       POINTER TO FREE NODES
PMTSTR DATA STRPMT       POINTER TO PROMPT STRING'S NODES
GPLPAR DATA 0        ;>0126 TIMODE   STRING TO CONTROL SPEED OF GPL INTERPRETER
CMDSTR DATA 0            STRING CONTAINING COMMAND LINE OPTIONS
*
ALIASA DATA DSK1,0       POINTERS TO THE ALIAS STRINGS, CURRENT DIRECTORY
ALIASB DATA DSK2,0
ALIASC DATA DSK3,0       The current directory does NOT include the Alias
ALIASD DATA DSK4,0
ALIASE DATA HDS1,0
ALIASF DATA HDS2,0
ALIASG DATA HDS3,0
ALIASH DATA SCS1,0
ALIASI DATA SCS2,0
ALIASJ DATA SCS3,0
ALIASK DATA 0,0
ALIASL DATA 0,0
ALIASM DATA 0,0
ALIASN DATA 0,0
ALIASO DATA 0,0
ALIASP DATA 0,0
*
* ^HANDLES are EQUated to >016C in other files; don't add ALIAS!
*
* for all handles, 0 input is keyboard, 0 output is screen
*
HANDL0 DATA 0                 stdin
HANDL1 DATA 0                 stdout
HANDL2 DATA 0                 stderr
HANDL3 DATA 0
HANDL4 DATA 0
HANDL5 DATA 0
HANDL6 DATA 0
HANDL7 DATA 0
HANDL8 DATA 0
HANDL9 DATA 0
HANDLA DATA 0
*
       AORG >0180
SAVPAD BSS  128
*
;
; This linked list must remain the same total length if modified.
;    64 nodes * 8 = >200 bytes
;    Nodes are used for Path, Prompt, etc
;
       AORG >0200
* STRPMT DATA >0000,>04*256+'$','n$','g'*256+>00   old default prompt

STRPMT DATA DFPRMA,>12*256+'$','_$','d$'   default prompt
DFPRMA DATA DFPRMB,'b$','t$','_$'
DFPRMB DATA DFPRMC,'n:','\$','p$'
DFPRMC DATA 0,'g'*256+>00,0,0

*
DSK1   DATA 0,>04*256+'D','SK','1'*256+>00
DSK2   DATA 0,>04*256+'D','SK','2'*256+>00
DSK3   DATA 0,>04*256+'D','SK','3'*256+>00
DSK4   DATA 0,>04*256+'D','SK','4'*256+>00
HDS1   DATA 0,>04*256+'H','DS','1'*256+>00
HDS2   DATA 0,>04*256+'H','DS','2'*256+>00
HDS3   DATA 0,>04*256+'H','DS','3'*256+>00
SCS1   DATA 0,>04*256+'S','CS','1'*256+>00
SCS2   DATA 0,>04*256+'S','CS','2'*256+>00
SCS3   DATA 0,>04*256+'S','CS','3'*256+>00

FRENOD
FRES00 DATA FRES01,0,0,0
FRES01 DATA FRES02,0,0,0
FRES02 DATA FRES03,0,0,0
FRES03 DATA FRES04,0,0,0
FRES04 DATA FRES05,0,0,0
FRES05 DATA FRE1,0,0,0
FRE1   DATA FRE2,0,0,0
FRE2   DATA FRE3,0,0,0
FRE3   DATA FRE4,0,0,0
FRE4   DATA FRE5,0,0,0
FRE5   DATA FRE6,0,0,0
FRE6   DATA FRE7,0,0,0
FRE7   DATA FRE8,0,0,0
FRE8   DATA FRE9,0,0,0
FRE9   DATA FREA,0,0,0
FREA   DATA FREB,0,0,0
FREB   DATA FREC,0,0,0
FREC   DATA FRED,0,0,0
FRED   DATA FREE,0,0,0
FREE   DATA FREF,0,0,0
FREF   DATA FREG,0,0,0
FREG   DATA FREH,0,0,0
FREH   DATA FREI,0,0,0
FREI   DATA FREJ,0,0,0
FREJ   DATA FREK,0,0,0
FREK   DATA FREL,0,0,0
FREL   DATA FREM,0,0,0
FREM   DATA FREN,0,0,0
FREN   DATA FREO,0,0,0
FREO   DATA FREP,0,0,0
FREP   DATA FREQ,0,0,0
FREQ   DATA FRER,0,0,0
FRER   DATA FRES,0,0,0
FRES   DATA FRET,0,0,0
FRET   DATA FREU,0,0,0
FREU   DATA FREV,0,0,0
FREV   DATA FREW,0,0,0
FREW   DATA FREX,0,0,0
FREX   DATA FREY,0,0,0
FREY   DATA FREZ,0,0,0
FREZ   DATA FRFA,0,0,0
FRFA   DATA FRFB,0,0,0
FRFB   DATA FRFC,0,0,0
FRFC   DATA FRFD,0,0,0
FRFD   DATA FRFE,0,0,0
FRFE   DATA FRFF,0,0,0
FRFF   DATA FRFG,0,0,0
FRFG   DATA FRFH,0,0,0
FRFH   DATA FRFI,0,0,0
FRFI   DATA 0,0,0,0
*
ENDNOD EQU  $
*
       END
*
